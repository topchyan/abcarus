<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  img-src 'self' data: blob:;
  style-src 'self' 'unsafe-inline';
  script-src 'self' 'unsafe-eval';
  font-src 'self' data:;
  connect-src 'self' data: blob: file:;
  media-src 'self' data: blob: file:;
">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ABCarus</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="stylesheet" href="../../third_party/tabulator/tabulator.min.css" />
  <link rel="stylesheet" href="./library_modal.css" />
</head>

<body>
	  <header>
	    <div class="header-row header-row-top">
	      <div class="controls">
	        <div class="segmented" aria-label="Library">
	          <button id="btnToggleLibrary" title="Toggle Library Tree (Ctrl+L). Shift-click: Library Catalog (Ctrl+Shift+L)">
              <span class="btn-icon icon-library" aria-hidden="true"></span>
              <span class="btn-text">Library</span>
            </button>
	        </div>
	        <div class="segmented" aria-label="File">
	          <button id="btnFileNew" type="button" title="New file (Ctrl+N)">
              <span class="btn-icon icon-file-plus" aria-hidden="true"></span>
              <span class="btn-text">New File</span>
            </button>
	          <button id="btnFileOpen" type="button" title="Open (Ctrl+O)">
              <span class="btn-icon icon-folder-open" aria-hidden="true"></span>
              <span class="btn-text">Open</span>
            </button>
	          <button id="btnFileSave" type="button" title="Save (Ctrl+S)">
              <span class="btn-icon icon-save" aria-hidden="true"></span>
              <span class="btn-text">Save</span>
            </button>
	          <button id="btnFileClose" type="button" title="Close file (Ctrl+W)">
              <span class="btn-icon icon-file-x" aria-hidden="true"></span>
              <span class="btn-text">Close</span>
            </button>
	          <button id="btnToggleRaw" type="button" title="Toggle raw file mode">
              <span class="btn-icon icon-file-code" aria-hidden="true"></span>
              <span class="btn-text">Raw</span>
            </button>
	        </div>
	        <div class="segmented" aria-label="Transport">
	          <button id="btnPlayPause" type="button" title="Play / Pause (F5)">
              <span class="btn-icon icon-play" aria-hidden="true"></span>
              <span class="btn-icon icon-pause" aria-hidden="true"></span>
              <span class="btn-text">Play</span>
            </button>
	          <button id="btnStop" type="button" title="Stop (Esc)">
              <span class="btn-icon icon-stop" aria-hidden="true"></span>
              <span class="btn-text">Stop</span>
            </button>
	        </div>
		        <div class="practice-controls" aria-label="Playback controls">
		          <label id="practiceTempoWrap" class="practice-tempo" hidden>
		            <span>Speed</span>
		            <select id="practiceTempo" aria-label="Playback speed">
		              <option value="0.5">50%</option>
	              <option value="0.6">60%</option>
	              <option value="0.7">70%</option>
	              <option value="0.8">80%</option>
	              <option value="0.9">90%</option>
	              <option value="1" selected>100%</option>
	              <option value="1.1">110%</option>
		              <option value="1.2">120%</option>
		            </select>
		          </label>
		          <label id="practiceLoopWrap" class="practice-loop" hidden>
		            <input id="practiceLoopEnabled" type="checkbox" />
		            <span>Loop</span>
		            <input id="practiceLoopFrom" class="practice-loop-num" type="number" inputmode="numeric" min="0" step="1" placeholder="from" title="Loop from measure (0 = first bar)" />
		            <span class="practice-loop-arrow">→</span>
		            <input id="practiceLoopTo" class="practice-loop-num" type="number" inputmode="numeric" min="0" step="1" placeholder="to" title="Loop to measure (0 = end)" />
		          </label>
		        </div>
		      </div>
		      <div class="right-controls">
		        <div class="segmented" aria-label="Preferences">
		          <button id="btnFonts" type="button" title="Fonts and soundfonts">
	              <span class="btn-icon icon-type" aria-hidden="true"></span>
	              <span class="btn-text">Fonts</span>
	            </button>
		        </div>
	        <div class="segmented" aria-label="View">
		          <button id="btnFocusMode" title="Playback focus mode (F7)" aria-label="Playback focus mode" aria-pressed="false">
	              <span class="btn-text">Focus</span>
	            </button>
		          <button id="btnResetLayout" title="Reset view (layout + zoom) (F8)" aria-label="Reset view (layout and zoom)">
	              <span class="btn-icon icon-reset" aria-hidden="true"></span>
	              <span class="btn-text">Reset view</span>
	            </button>
		        </div>
		      </div>
		    </div>
		  </header>

  <main>
	    <aside class="sidebar">
	      <div class="sidebar-header">
	        <div class="sidebar-controls">
	          <div class="library-root-row">
	            <button id="btnLibraryRefresh" class="sidebar-action" type="button" title="Refresh library">Refresh</button>
	            <div class="library-root" id="libraryRoot" title="">Library: (none)</div>
	          </div>
	          <div class="scan-status" id="scanStatus">Idle</div>
	          <div class="sidebar-control">
	            <div class="sidebar-label">Group by:</div>
	            <select id="groupBy">
              <option value="file">File</option>
              <option value="x">X (Reference)</option>
              <option value="composer">C (Composer)</option>
              <option value="meter">M (Meter)</option>
              <option value="key">K (Key)</option>
              <option value="unit">L (Unit Length)</option>
              <option value="tempo">Q (Tempo)</option>
              <option value="rhythm">R (Rhythm)</option>
              <option value="source">S (Source)</option>
              <option value="origin">O (Origin)</option>
              <option value="group">G (Group)</option>
            </select>
          </div>
          <div class="sidebar-control">
            <div class="sidebar-label">Sort by:</div>
            <select id="sortBy">
              <option value="file_asc">File/Tune Asc</option>
              <option value="file_desc">File/Tune Desc</option>
              <option value="count_asc">Tune Count Asc</option>
              <option value="count_desc">Tune Count Desc</option>
              <option value="update_asc">Update Asc</option>
              <option value="update_desc" selected>Update Desc</option>
            </select>
          </div>
	          <div class="sidebar-control sidebar-search">
	            <div class="sidebar-label">Filter:</div>
	            <input id="librarySearch" type="text" placeholder="Title, composer, key…" />
	            <button id="btnLibraryClearFilter" class="sidebar-action" type="button" title="Clear filter">Clear</button>
	          </div>
	        </div>
	      </div>
	      <div class="sidebar-body">
	        <div class="tree" id="libraryTree"></div>
	        <div class="sidebar-split" id="sidebarSplit" role="separator" aria-orientation="horizontal" tabindex="0"></div>
      </div>
    </aside>

    <div class="divider" id="paneDivider" role="separator" aria-orientation="vertical" tabindex="0"></div>

	    <section class="pane right">
	      <div class="file-header-panel" id="fileHeaderPanel">
	        <div class="file-header-bar">
	          <button id="fileHeaderToggle" class="file-header-title header-state" type="button" title="No file header in this file.">
	            <span class="header-state-label">Header</span>
            <span id="headerStateMarker" class="header-state-marker" aria-hidden="true">—</span>
          </button>
          <select id="fileTuneSelect"></select>
          <button id="scanErrorTunes" class="scan-error-button" type="button" hidden>Scan for errors</button>
          <button id="errorsIndicator" class="errors-indicator" type="button" aria-label="Errors" hidden disabled>
            Errors: 0
          </button>
          <span id="errorsFocusMessage" class="errors-focus-message" hidden></span>
          <div class="file-header-toggles controls segmented" aria-label="Mode toggles">
            <button id="btnToggleErrors" type="button" title="Toggle errors features">Errors</button>
            <button id="btnToggleFollow" type="button" title="Toggle playback follow">Follow</button>
            <button id="btnToggleGlobals" type="button" title="Toggle global header">Globals</button>
          </div>
          <div class="file-header-meta">
            <div class="dirty-indicator" id="dirtyIndicator" aria-live="polite"></div>
          </div>
        </div>
        <div id="fileHeaderEditor" class="file-header-editor" aria-label="File header"></div>
        <div class="file-header-actions">
          <button id="fileHeaderSave" type="button">Save Header</button>
          <button id="fileHeaderReload" type="button">Reload</button>
        </div>
      </div>
      <div class="right-split">
        <div class="editor-pane">
          <div id="abc-editor"></div>
        </div>
        <div class="split-divider" id="splitDivider" role="separator" aria-orientation="vertical" tabindex="0"></div>
        <div class="render-pane">
          <div id="out"></div>
        </div>
      </div>
    </section>
  </main>

	  <footer class="taskbar">
	    <div class="taskbar-left">
	      <div id="status">Ready</div>
	      <div id="hoverStatus" class="hover-status" aria-live="polite"></div>
	      <div id="toolStatus" class="tool-status" aria-live="polite"></div>
	    </div>
	    <div id="cursorStatus" class="cursor-status"></div>
	    <div id="bufferStatus" class="buffer-status" aria-live="polite"></div>
		  </footer>
		  <div id="toast" class="toast" role="status" aria-live="polite"></div>

			  <div id="errorsPopover" class="errors-popover hidden" role="dialog" aria-label="Errors list">
			    <div class="errors-popover-header">
			      <span id="errorsPopoverTitle">Errors</span>
			    </div>
			    <div id="errorsList" class="errors-list"></div>
			  </div>
	
  <div class="modal" id="settingsModal" aria-hidden="true">
    <div class="modal-card settings-card" role="dialog" aria-label="Settings">
      <div class="modal-header">
        <div class="modal-title">Settings</div>
        <div class="settings-header-controls" aria-label="Settings controls">
          <div class="segmented" role="group" aria-label="Settings mode">
            <button id="settingsModeBasic" type="button" aria-pressed="true">Basic</button>
            <button id="settingsModeAdvanced" type="button" aria-pressed="false">Advanced</button>
          </div>
          <label class="settings-search">
            <span class="settings-search-label">Search</span>
            <input id="settingsFilter" type="text" aria-label="Search settings" placeholder="Search…" />
          </label>
        </div>
        <!-- Legacy control kept for compatibility until settings.js is updated (Prompt 4). -->
        <button class="modal-close" id="settingsClose" type="button" hidden>Close</button>
      </div>
      <div class="modal-body">
        <div class="settings-layout" aria-label="Settings layout">
          <div class="settings-nav">
            <!-- Legacy control kept for compatibility; hidden in the new UI (Prompt 4 removes reliance). -->
            <input id="settingsShowAdvanced" type="checkbox" hidden />
            <div class="settings-tabs" id="settingsTabs" role="tablist" aria-label="Settings sections"></div>
          </div>
          <div class="settings-content">
            <div class="settings-section-header" aria-label="Settings section">
              <div id="settingsSectionTitle" class="settings-section-title"></div>
              <div id="settingsSectionHint" class="settings-section-hint"></div>
            </div>
            <div id="settingsNoResults" class="settings-no-results hidden" role="status" aria-live="polite"></div>
            <div class="settings-panels" id="settingsPanels"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <button id="settingsExport" type="button">Export…</button>
          <button id="settingsImport" type="button">Import…</button>
          <button id="settingsResetSection" type="button">Defaults</button>
        </div>
        <button id="settingsCancel" type="button">Cancel</button>
        <button id="settingsApply" type="button">Apply</button>
        <button id="settingsOk" class="primary" type="button">OK</button>
        <!-- Legacy control kept for compatibility until settings.js is updated (Prompt 4). -->
        <button id="settingsReset" type="button" hidden>Reset Defaults</button>
      </div>
    </div>
  </div>

  <div class="modal" id="moveTuneModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-label="Move Tune">
      <div class="modal-header">
        <div class="modal-title">Move Tune</div>
        <button class="modal-close" id="moveTuneClose" type="button">Close</button>
      </div>
      <div class="modal-body">
        <label class="settings-row">
          <span>Target file</span>
          <select id="moveTuneTarget"></select>
        </label>
      </div>
      <div class="modal-footer">
        <button id="moveTuneApply" class="primary" type="button">Move</button>
        <button id="moveTuneCancel" type="button">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal" id="aboutModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-label="About">
      <div class="modal-header">
        <div class="modal-title">About ABCarus</div>
        <button class="modal-close" id="aboutClose" type="button">Close</button>
      </div>
      <div class="modal-body">
        <pre id="aboutInfo" class="about-info"></pre>
      </div>
      <div class="modal-footer">
        <button id="aboutCopy" type="button">Copy</button>
      </div>
    </div>
  </div>

  <div class="modal" id="setListModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-label="Set List">
      <div class="modal-header">
        <div class="modal-title">Set List</div>
        <button class="modal-close" id="setListClose" type="button">Close</button>
      </div>
      <div class="modal-body">
        <div id="setListEmpty" class="set-list-empty">
          Add tunes to build an ordered list, preview it, and export it as a new .abc file.
        </div>
        <div id="setListItems" class="set-list-items" hidden></div>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <label class="set-list-inline">
            <span>Page breaks</span>
            <select id="setListPageBreaks">
              <option value="perTune">Per tune</option>
              <option value="none">None</option>
              <option value="auto">Auto</option>
            </select>
          </label>
          <label class="set-list-inline">
            <input id="setListCompact" type="checkbox" />
            <span>Compact spacing</span>
          </label>
        </div>
        <button id="setListClear" type="button">Clear</button>
        <button id="setListSaveAbc" class="primary" type="button">Export ABC…</button>
        <button id="setListExportPdf" type="button">Export PDF…</button>
        <button id="setListPrint" type="button">Print…</button>
      </div>
    </div>
  </div>

  <div class="modal" id="xIssuesModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-label="X Issues">
      <div class="modal-header">
        <div class="modal-title">X issues</div>
        <button class="modal-close" id="xIssuesClose" type="button">Close</button>
      </div>
      <div class="modal-body">
        <pre id="xIssuesInfo" class="about-info"></pre>
      </div>
      <div class="modal-footer">
        <button id="xIssuesAutoFix" type="button">Auto-fix: Renumber X…</button>
        <button id="xIssuesJump" type="button">Jump</button>
        <button id="xIssuesCopy" type="button">Copy</button>
      </div>
    </div>
  </div>

  <div class="modal" id="disclaimerModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-label="Early-stage release">
      <div class="modal-header">
        <div class="modal-title">Early-stage release</div>
      </div>
      <div class="modal-body">
        <p>ABCarus is functional but still under active development. Expect changes and keep backups.</p>
      </div>
      <div class="modal-footer">
        <button id="disclaimerOk" class="primary" type="button">OK</button>
      </div>
    </div>
  </div>

  <div id="libOverlay" class="lib-overlay" hidden>
    <div class="lib-modal" role="dialog" aria-modal="true" aria-label="Library Catalog">
      <div class="lib-header">
        <div class="lib-header-top">
          <div class="lib-title">Library Catalog</div>
          <button id="libClose" class="lib-x" type="button" aria-label="Close">×</button>
        </div>
        <div class="lib-header-bottom">
          <div class="lib-hint">Tip: use Quick filter to search; double-click a row to open.</div>
          <div class="lib-controls">
            <label class="lib-label">
              Quick filter
              <input id="libFilter" class="lib-input" type="text" autocomplete="off" />
            </label>
            <button id="libOpen" class="lib-btn primary" type="button" disabled>Open</button>
          </div>
        </div>
      </div>
      <div class="lib-body">
        <div id="libTable" class="lib-table"></div>
      </div>
      <div class="lib-footer">
        <div id="libStatus" class="lib-status" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <script src="../../third_party/abc2svg/abc2svg-1.js"></script>
  <script src="../../third_party/abc2svg/snd-1.js"></script>
  <script src="../../third_party/tabulator/tabulator.min.js"></script>
  <script type="module" src="./renderer.js"></script>
  <script src="./library_modal.js"></script>

</body>

</html>
